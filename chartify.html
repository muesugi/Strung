<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Strung</title>
		<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
		<script src="http://cdnjs.cloudflare.com/ajax/libs/raphael/2.1.0/raphael-min.js"></script>
		<script src="js/canvg.js"></script> <!--needed? imported from string -->
		<style>
			body { margin: 0; }
			canvas { width: 100%; height: 100% }
			#container {width: 100%; height: 500px;}
		</style>
	</head>
	<body>

	<canvas id="canvas" style="display:none;"></canvas>
	<div id="container"> </div>
	<textarea id="textarea" spellcheck=false></textarea>

	<script>
		//global:
		var paper = Raphael(document.getElementById('container'), "100%", "100%"); 
		//creates the canvas. 100% of 50% of window size

		var xpos = 100;
		var ypos = 100;

		//magnitude? 
		var direction = 1;

		//SYMBOLS -- abstracting out relative position
		//named according to US crochet convention
		//see http://dabblesandbabbles.com/wp-content/uploads/2014/02/Crochet-Symbols-Chart1.pdf
		function chain(){ //simple rendering of chain (ch) symbol
			ch = paper.ellipse(xpos, ypos, 15, 5);
		}
		function slip(){ // slip stitch (sl st)
			slst = paper.circle(xpos, ypos, 5);
			slst.attr({"fill": "#000"});
		}
		function single(){ // single crochet (sc)
			sc_vert = paper.path("M"+xpos+","+ypos+"v"+(-12)); //bottom-up
			//line from (xpos, ypos) to (xpos, ypos-12)

			sc_hor = paper.path("M"+(xpos-6)+","+(ypos-6)+"h"+(12));
			//line from (xpos-6, ypos-6) to (xpos+6, ypos-6)
			//make both lines bolder?	
		}
		function half_double(){ // half double crochet (hdc)
			hdc_vert = paper.path("M"+xpos+","+ypos+"v"+(-20));
			//line from (xpos, ypos) to (xpos, ypos-20)
			hdc_hor = paper.path("M"+(xpos-5)+","+(ypos-20)+"h"+10);
			//line from (xpos-5, ypos-20) to (xpos+5, ypos-20)
		}
		function double(){ // double crochet (dc)
			dc_vert = paper.path("M"+xpos+","+ypos+"v"+(-20));
			//line from (xpos, ypos) to (xpos, ypos-20)
			dc_hor = paper.path("M"+(xpos-5)+","+(ypos-20)+"h"+10);
			//line from (xpos-5, ypos-20) to (xpos+5, ypos-20)
			dc_dia = paper.path("M"+(xpos-4)+","+(ypos-13)+"l"+8+","+(Math.sqrt(17)));
			//line from (xpos-4, ypos-13) to (xpos+4, ypos-13+sqrt(17))
			//length is sqrt(64 + 17) == sqrt(81) == 9
		}
		function treble(){ // treble crochet (tc)
			tr_vert = paper.path("M"+xpos+","+ypos+"v"+(-20));
			//line from (xpos, ypos) to (xpos, ypos-20)
			tr_hor = paper.path("M"+(xpos-5)+","+(ypos-20)+"h"+10);
			//line from (xpos-5, ypos-20) to (xpos+5, ypos-20)
			tr_dia1 = paper.path("M"+(xpos-4)+","+(ypos-15)+"l"+8+","+(Math.sqrt(17)));
			//line from (xpos-4, ypos-15) to (xpos+4, ypos-15+sqrt(17))
			//length is sqrt(64 + 17) == sqrt(81) == 9
			tr_dia2 = paper.path("M"+(xpos-4)+","+(ypos-12)+"l"+8+","+(Math.sqrt(17)));
			//line from (xpos-4, ypos-12) to (xpos+4, ypos-12+sqrt(17))
		}
		function double_treble(){ // treble crochet (tc)
			dtr_vert = paper.path("M"+xpos+","+ypos+"v"+(-20));
			//line from (xpos, ypos) to (xpos, ypos-20)
			dtr_hor = paper.path("M"+(xpos-5)+","+(ypos-20)+"h"+10);
			//line from (xpos-5, ypos-20) to (xpos+5, ypos-20)
			dtr_dia1 = paper.path("M"+(xpos-4)+","+(ypos-16)+"l"+8+","+(Math.sqrt(17)));
			//line from (xpos-4, ypos-16) to (xpos+4, ypos-16+sqrt(17))
			//length is sqrt(64 + 17) == sqrt(81) == 9
			dtr_dia2 = paper.path("M"+(xpos-4)+","+(ypos-13)+"l"+8+","+(Math.sqrt(17)));
			//line from (xpos-4, ypos-13) to (xpos+4, ypos-13+sqrt(17))
			dtr_dia3 = paper.path("M"+(xpos-4)+","+(ypos-10)+"l"+8+","+(Math.sqrt(17)));
			//line from (xpos-4, ypos-10) to (xpos+4, ypos-10+sqrt(17))
		}

		/// RENDER symbols

		callstitch("chain");

		function callstitch(funcname){
			//paper.setViewBox(0,0,650,650,false);

			chain();
			xpos = xpos + 100;
			slip();
			xpos = xpos + 100;
			single();
			xpos = xpos + 100;
			half_double();
			xpos = xpos + 100;
			double();
			xpos = xpos + 100;
			treble();
			xpos = xpos + 100;
			double_treble();
			//draw_chains(5);

			//adds the canvas contents to the hidden image.
			canvg('canvas', $("#container").html());
			// the canvas calls to output a png
			var canvas = document.getElementById("canvas");
			var img = canvas.toDataURL("image/png");
			$('#converted_image').attr('src', img);
		}

		///draw symbols with a given quantity and current position
		function draw_chains(n_chains){
			for(i = 0; i < n_chains; i++){
				chain();
				xpos = xpos + .5;
			}
		}



		</script>
	</body>
</html>